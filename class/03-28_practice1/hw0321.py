# -*- coding: utf-8 -*-
"""hw0321.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/121g9FnufVDYUS8lGxv-avby1hKRYs3J4

# ä½œæ¥­
K-meansåˆ†ç¾¤

åˆ†ç¾¤å®Œæˆå¾Œï¼Œé‡å°æ¯ä¸€ç¾¤çš„ç—…äºº
è§€æŸ¥é€™äº›è®Šæ•¸(é€éå¹³å‡å€¼ã€ä¸­ä½æ•¸...æ•˜è¿°å‹çµ±è¨ˆ)ï¼Œçµ¦äºˆè©²ç¾¤ä¸€å€‹åç¨±å®šç¾© (ä¾‹å¦‚: é«˜è¡€é…¯ç—‡å€™ç¾¤ç­‰)
ä¸¦ä¸”å°æ–¼è©²ç¾¤çµ¦äºˆé†«ç™‚ä¸Šçš„å»ºè­°èˆ‡è¡›æ•™æ–¹å¼

æç¤º: ä¹Ÿå¯ä»¥åƒè€ƒè©²ç¾¤å…§çš„è…è‡Ÿç—…æ‚£è€…æ¯”ä¾‹ (Yes/No)ï¼Œ
é€™è¡¨ç¤ºåˆ†ç¾¤æ™‚ï¼ŒChronic Kidney Disease: yes è©²æ¬„ä½ä¸¦æœªå¼•å…¥ï¼Œæœ€å¾Œå¾—åˆ°ç¾¤çš„ç—…äººæ™‚ï¼Œæ‰å¼•å…¥

æœ€å¾Œï¼Œè«‹é€éæ–‡å­—åœ–è¡¨ä¾†è¡¨ç¤ºï¼Œæ¯ç¾¤çš„ç‰¹å¾µ

### å…ˆæŠŠé€™å€‹é›²ç«¯ç¡¬ç¢Ÿæ–°å¢æ·å¾‘åˆ°è‡ªå·±å¸³è™Ÿçš„ç¡¬ç¢Ÿè£¡
[å…±ç”¨é›²ç«¯ç¡¬ç¢Ÿ](https://drive.google.com/drive/folders/1XsTQzu-a0ktHBfYL1Oq619gIY98t4w6w?usp=sharing)

[å»ºç«‹æ·å¾‘èªªæ˜](https://docs.google.com/document/d/1LqTN5l97p2zFkWafLXgoJ8_0TbI-VzQ7qJiviQzcDl8/edit?usp=sharing)

[åˆ†ç¾¤æ•˜è¿°](https://docs.google.com/document/d/1Ta44NNMB4BRYgmQdJ_k-pdVcoMm1iJr3jnyuq1WAD_8/edit?usp=sharing)

##æ›è¼‰ Google Drive ä¸¦è¨­å®šå°ˆæ¡ˆè·¯å¾‘
æ­¤æ­¥é©Ÿç”¨ä¾†æ›è¼‰ Google Driveï¼Œä¸¦è¨­å®šå°ˆæ¡ˆè³‡æ–™å¤¾è·¯å¾‘ï¼Œæ–¹ä¾¿å¾ŒçºŒè®€å¯«è³‡æ–™ã€‚
"""

from google.colab import drive
import os
drive.mount('/content/drive', force_remount=True)

GOOGLE_HOME_PATH = "My Drive"
PROJECT_PATH = "K-meansåˆ†ç¾¤_Kidney Disease"
TARGET_PATH = os.path.join("/content/drive", GOOGLE_HOME_PATH, PROJECT_PATH)

if not os.path.exists(TARGET_PATH):
    os.makedirs(TARGET_PATH)
print(f"ç›®æ¨™è³‡æ–™å¤¾ï¼š{TARGET_PATH}")
print("è³‡æ–™å¤¾å…§å®¹ï¼š", os.listdir(TARGET_PATH))

"""## ä¸€ã€è®€å–åŸå§‹è³‡æ–™ & å‰è™•ç†
å…ˆè®€å–åŸå§‹è³‡æ–™ï¼Œä¸¦ä¿ç•™åŒ…å«ã€ŒChronic Kidney Disease: yesã€çš„å®Œæ•´è³‡æ–™ï¼ˆ`df_original`ï¼‰ï¼Œ
æ¥è‘—åœ¨åˆ†ç¾¤æ™‚åªä½¿ç”¨å…¶ä»–ç‰¹å¾µï¼ˆæ’é™¤ CKD æ¬„ä½èˆ‡å¾ŒçºŒå¯èƒ½çš„åˆ†ç¾¤ç·¨è™Ÿæ¬„ä½ï¼‰ã€‚
"""

import pandas as pd
import numpy as np

file_path = os.path.join(TARGET_PATH, "kidney_disease.csv")
df_original = pd.read_csv(file_path)
df_original.info()

feature_cols = df_original.columns.drop(['Chronic Kidney Disease: yes', 'Cluster'], errors='ignore')
df = df_original[feature_cols].copy()
df.head(10)

"""## äºŒã€é›¢ç¾¤å€¼æª¢æŸ¥èˆ‡æ•¸å€¼ç‰¹å¾µè™•ç†"""

import matplotlib.pyplot as plt
import seaborn as sns
import math

num_cols = df.select_dtypes(include=['float64', 'int64']).columns
outlier_report = []
for col in num_cols:
    Q1 = df[col].quantile(0.25)
    Q3 = df[col].quantile(0.75)
    IQR = Q3 - Q1
    lower_bound = Q1 - 1.5 * IQR
    upper_bound = Q3 + 1.5 * IQR
    outliers = df[(df[col] < lower_bound) | (df[col] > upper_bound)]
    outlier_report.append({
        'Column': col,
        'Outlier_Count': len(outliers),
        'Outlier_Percent': len(outliers) / len(df),
        'Lower_Bound': lower_bound,
        'Upper_Bound': upper_bound
    })

outlier_report_df = pd.DataFrame(outlier_report)
outlier_report_df.sort_values(by='Outlier_Percent', ascending=False, inplace=True)
outlier_report_df

"""## ä¸‰ã€è‡ªå‹•æ‰¾æœ€é©åˆçš„ï¼«å€¼"""

from yellowbrick.cluster import KElbowVisualizer
from sklearn.cluster import KMeans

km = KMeans(init="k-means++", random_state=0, n_init="auto")
visualizer = KElbowVisualizer(km, k=(2,10))
visualizer.fit(df)
visualizer.show()

"""## å››ã€åˆ†ç¾¤å‰æ•¸å€¼ç‰¹å¾µæ¨™æº–åŒ–èˆ‡ K-Means åˆ†ç¾¤"""

from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import silhouette_score

df_numeric = df[num_cols].dropna()
scaler = StandardScaler()
X_scaled = scaler.fit_transform(df_numeric)

wcss = []
K_range = range(2, 11)
for k in K_range:
    kmeans = KMeans(n_clusters=k, random_state=42, n_init=10)
    kmeans.fit(X_scaled)
    wcss.append(kmeans.inertia_)
elbow_df = pd.DataFrame({'K': list(K_range), 'WCSS': wcss})
print(elbow_df)

kmeans = KMeans(n_clusters=4, random_state=42, n_init=10)
df_numeric['Cluster'] = kmeans.fit_predict(X_scaled)

"""## äº”ã€åˆ†ç¾¤çµæœè¦–è¦ºåŒ–èˆ‡æè¿°çµ±è¨ˆ

### 0.ä¸­æ–‡å¥—ä»¶
"""

# @title
# è£œcolabä¸­æ–‡å­—é«”
!apt-get update -y
!apt-get install -y fonts-noto-cjk

# @title
# æŒ‡å®šå­—é«”æª”è·¯å¾‘
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
font_path = '/usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc'
font_prop = fm.FontProperties(fname=font_path, size=14)

"""### 1.å„ç¾¤å¹³å‡æ•¸å€¼èˆ‡ä¸­ä½æ•¸
-ç›®çš„ï¼šè¨ˆç®—ä¸¦å±•ç¤ºå„ç¾¤çš„å¹³å‡æ•¸å€¼èˆ‡ä¸­ä½æ•¸ï¼Œäº†è§£ç¾¤çµ„åŸºæœ¬ç‰¹å¾µ
"""

# è¨ˆç®—å„ç¾¤çš„å¹³å‡å€¼èˆ‡ä¸­ä½æ•¸
cluster_profile_mean = df_numeric.groupby('Cluster').mean()    # ä¾æ“š 'Cluster' åˆ†ç¾¤è¨ˆç®—å¹³å‡å€¼
cluster_profile_median = df_numeric.groupby('Cluster').median()  # ä¾æ“š 'Cluster' åˆ†ç¾¤è¨ˆç®—ä¸­ä½æ•¸

print("å„ç¾¤å¹³å‡æ•¸æ“š:")
print(cluster_profile_mean)   # è¼¸å‡ºå„ç¾¤å¹³å‡æ•¸æ“š

print("\nå„ç¾¤ä¸­ä½æ•¸æ•¸æ“š:")
print(cluster_profile_median)  # è¼¸å‡ºå„ç¾¤ä¸­ä½æ•¸æ•¸æ“š

"""**Cluster 0**  
- **å¹´é½¡ (Age)**ï¼šå¹³å‡ç´„ 57.48 æ­²ã€‚  
- **è¡€å£“ (Blood Pressure)**ï¼šå¹³å‡ç´„ 78.41 mm/Hgï¼Œå±¬æ–¼ä¸­ç­‰åä½ã€‚  
- **å°¿æ¯”é‡èˆ‡ç™½è›‹ç™½ (Specific Gravity èˆ‡ Albumin)**ï¼šå°¿æ¯”é‡ç´„ 1.0128ï¼ŒAlbumin ç´„ 2.59ï¼Œæç¤ºå¯èƒ½å­˜åœ¨è›‹ç™½è³ªä»£è¬ç•°å¸¸ã€‚  
- **è¡€ç³–èˆ‡è¡€å°¿ç´  (Blood Glucose Random èˆ‡ Blood Urea)**ï¼šéš¨æ©Ÿè¡€ç³–å¹³å‡ 186.05 mgs/dLï¼Œè¡€å°¿ç´ ç´„ 75.04 mgs/dLï¼Œé€™å…©é …æ•¸å€¼è¼ƒé«˜ï¼Œå¯èƒ½ä»£è¡¨ä»£è¬åŠŸèƒ½å—å½±éŸ¿ã€‚  
- **è…åŠŸèƒ½æŒ‡æ¨™ (Serum Creatinine)**ï¼šç´„ 3.55 mgs/dLï¼Œåé«˜ï¼Œé¡¯ç¤ºè…åŠŸèƒ½å¯èƒ½æœ‰å•é¡Œã€‚  
- **é›»è§£è³ª (Sodium èˆ‡ Potassium)**ï¼šSodium ç´„ 133.64 mEq/Lï¼ŒPotassium ç´„ 4.42 mEq/Lï¼Œå±¬æ–¼æ­£å¸¸æˆ–ç•¥ä½æƒ…å½¢ã€‚  
- **å…¶ä»–å¿ƒè¡€ç®¡åŠä»£è¬ç›¸é—œ**ï¼šä¾‹å¦‚ Coronary Artery Disease ç´„ 0.23ã€Pedal Edema ç´„ 0.36ã€Anemia ç´„ 0.30ï¼Œé€™äº›æŒ‡æ¨™å‡æœ‰ä¸€å®šç•°å¸¸ã€‚  
- **PCA çµæœ**ï¼šç¬¬ä¸€ä¸»æˆåˆ†ç´„ -3.38ï¼Œç¬¬äºŒä¸»æˆåˆ†ç´„ 1.00ï¼Œç¬¬ä¸‰ä¸»æˆåˆ†ç´„ 1.89ï¼Œæä¾›é™ç¶­å¾Œç¾¤å…§çµæ§‹åƒè€ƒã€‚  
- **CKD æŒ‡æ¨™**ï¼šæ‰€æœ‰æ‚£è€… CKD å¹³å‡ç‚º 1.00ï¼Œä»£è¡¨æœ¬ç¾¤æ‰€æœ‰æ‚£è€…å‡ç‚ºæ…¢æ€§è…ç—…æ‚£è€…ã€‚  
- **é¢¨éšªåˆ†æ•¸ (Risk_Score)**ï¼šå¹³å‡ç´„ 24.84ï¼ŒHigh_Risk ç´„ 0.80ï¼Œé¡¯ç¤ºå¤šæ•¸æ‚£è€…å±¬æ–¼è¼ƒé«˜é¢¨éšªçµ„åˆ¥ã€‚

**ç¶œåˆè§£è®€**ï¼šCluster 0 æ‚£è€…å¹´é½¡åä¸­è€ã€è…åŠŸèƒ½æŒ‡æ¨™æ˜é¡¯ç•°å¸¸ï¼ˆè¡€æ¸…è‚Œé…åé«˜ï¼‰ï¼Œä¸”å…¨ç¾¤å‡æœ‰ CKDï¼Œæ­¤ç¾¤å¯èƒ½ç‚ºé‡åº¦è…ç—…æ‚£è€…ç¾¤ï¼Œéœ€ç‰¹åˆ¥é—œæ³¨è…åŠŸèƒ½åŠä»£è¬ç•°å¸¸ç®¡ç†ã€‚

---

**Cluster 1**  
- **å¹´é½¡**ï¼šå¹³å‡ç´„ 44.32 æ­²ï¼Œæ˜é¡¯æ¯”å…¶ä»–ç¾¤å¹´è¼•ã€‚  
- **è¡€å£“**ï¼šå¹³å‡ç´„ 72.11 mm/Hgï¼Œè¼ƒä½ã€‚  
- **å°¿æ¯”é‡èˆ‡ Albumin**ï¼šå°¿æ¯”é‡ç´„ 1.0209ï¼ŒAlbumin åƒ…ç´„ 0.18ï¼Œé¡¯ç¤ºç”Ÿç†ç‹€æ³ç›¸å°ç©©å®šã€‚  
- **è¡€ç³–èˆ‡è¡€å°¿ç´ **ï¼šéš¨æ©Ÿè¡€ç³–å¹³å‡ 109.32 mgs/dLï¼Œè¡€å°¿ç´ ç´„ 32.30 mgs/dLï¼Œå‡è™•æ–¼æ­£å¸¸æˆ–æ¥è¿‘æ­£å¸¸ç¯„åœã€‚  
- **è…åŠŸèƒ½ (Serum Creatinine)**ï¼šå¹³å‡ç´„ 1.08 mgs/dLï¼Œå±¬æ–¼æ­£å¸¸ã€‚  
- **å…¶ä»–æŒ‡æ¨™**ï¼šä¾‹å¦‚ Coronary Artery Disease ç‚º 0.00ï¼ŒAnemia ç´„ 0.01ï¼Œé¡¯ç¤ºæ­¤ç¾¤å¿ƒè¡€ç®¡å’Œè²§è¡€é¢¨éšªä½ã€‚  
- **PCA çµæœ**ï¼šPCA1 ç´„ 2.41ï¼ŒPCA2 ç´„ -0.125ï¼ŒPCA3 ç´„ 0.09ã€‚  
- **CKD æŒ‡æ¨™**ï¼šåƒ…ç´„ 21% æ‚£è€…ç‚º CKDï¼Œé¡¯ç¤ºå¤§å¤šæ•¸æ‚£è€…ç„¡è…ç—…ã€‚  
- **é¢¨éšªåˆ†æ•¸**ï¼šå¹³å‡ç´„ 10.98ï¼ŒHigh_Risk ç´„ 0.25ï¼Œå±¬æ–¼ä½é¢¨éšªç¾¤ã€‚

**ç¶œåˆè§£è®€**ï¼šCluster 1 æ‚£è€…å¹´é½¡åè¼•ã€è¡€å£“å’Œè…åŠŸèƒ½æ­£å¸¸ï¼Œä¸” CKD æ‚£è€…æ¯”ä¾‹è¼ƒä½ï¼Œæ•´é«”å¥åº·é¢¨éšªä½ï¼Œå±¬æ–¼ä½é¢¨éšªå¹´è¼•å¥åº·ç¾¤ã€‚

---

**Cluster 2**  
- **å¹´é½¡**ï¼šå¹³å‡ç´„ 55.64 æ­²ï¼Œèˆ‡å…¶ä»–ç¾¤ç›¸æ¯”å±¬ä¸­é–“åä¸‹ã€‚  
- **è¡€å£“**ï¼šå¹³å‡ç´„ 83.40 mm/Hgï¼Œå±¬è¼ƒé«˜æ°´å¹³ã€‚  
- **å°¿æ¯”é‡èˆ‡ Albumin**ï¼šå°¿æ¯”é‡ç´„ 1.0158ï¼ŒAlbumin ç´„ 1.82ã€‚  
- **è¡€ç³–èˆ‡è¡€å°¿ç´ **ï¼šéš¨æ©Ÿè¡€ç³–ç´„ 159.78 mgs/dLï¼Œè¡€å°¿ç´ ç´„ 141.04 mgs/dLï¼Œå…©è€…å‡åé«˜ã€‚  
- **è…åŠŸèƒ½ (Serum Creatinine)**ï¼šç´„ 11.13 mgs/dLï¼Œéå¸¸é«˜ï¼Œé¡¯ç¤ºåš´é‡è…åŠŸèƒ½æå®³ã€‚  
- **é›»è§£è³ª**ï¼šPotassium ç´„ 6.42 mEq/Lï¼Œæ˜é¡¯åé«˜ï¼›Sodium ç´„ 130.07 mEq/L ç•¥ä½ã€‚  
- **å…¶ä»–æŒ‡æ¨™**ï¼šAnemia ç´„ 0.70ï¼Œè¡¨æ˜è²§è¡€ç™¼ç”Ÿç‡é«˜ã€‚  
- **PCA çµæœ**ï¼šPCA1 ç´„ -3.79ï¼ŒPCA2 ç´„ -1.93ï¼ŒPCA3 ç´„ -0.68ã€‚  
- **CKD æŒ‡æ¨™**ï¼šæ‰€æœ‰æ‚£è€…å‡ç‚º CKD (1.00)ï¼Œè¡¨æ˜å…¨ç¾¤å‡æœ‰è…ç—…ã€‚  
- **é¢¨éšªåˆ†æ•¸**ï¼šå¹³å‡ç´„ 48.12ï¼ŒHigh_Risk ç´„ 0.96ï¼Œé¡¯ç¤ºæ­¤ç¾¤å¤§å¤šå±¬æ–¼æ¥µé«˜é¢¨éšªçµ„åˆ¥ã€‚

**ç¶œåˆè§£è®€**ï¼šCluster 2 æ‚£è€…çš„è…åŠŸèƒ½æ¥µå·®ï¼ˆè¡€æ¸…è‚Œé…æ¥µé«˜ã€è¡€å°¿ç´ èˆ‡é‰€æ¿ƒåº¦é¡¯è‘—ç•°å¸¸ï¼‰ï¼Œä¸”å…¨ç¾¤å‡æœ‰ CKDï¼Œæ­¤ç¾¤å±¬æ–¼é«˜é¢¨éšªã€é‡ç—‡è…åŠŸèƒ½ä¸å…¨ç¾¤ï¼Œéœ€è¦ç©æ¥µæ²»ç™‚èˆ‡å¯†åˆ‡ç›£æ§ã€‚

---

**Cluster 3**  
- **å¹´é½¡**ï¼šå¹³å‡ç´„ 59.43 æ­²ï¼Œç•¥é«˜æ–¼ Cluster 1ï¼Œä½æ–¼ Cluster 0ã€‚  
- **è¡€å£“**ï¼šå¹³å‡ç´„ 79.41 mm/Hgï¼Œå±¬ä¸­ç­‰æ°´å¹³ã€‚  
- **å°¿æ¯”é‡èˆ‡ Albumin**ï¼šå°¿æ¯”é‡ç´„ 1.0142ï¼ŒAlbumin ç´„ 1.18ã€‚  
- **è¡€ç³–èˆ‡è¡€å°¿ç´ **ï¼šéš¨æ©Ÿè¡€ç³–ç´„ 184.34 mgs/dLï¼Œè¡€å°¿ç´ ç´„ 55.93 mgs/dLï¼Œè¡€ç³–åé«˜ä½†è¡€å°¿ç´ è¼ƒä½ã€‚  
- **è…åŠŸèƒ½ (Serum Creatinine)**ï¼šå¹³å‡ç´„ 2.72 mgs/dLï¼Œé¡¯ç¤ºè…åŠŸèƒ½ç•°å¸¸ä½†ä¸å¦‚ Cluster 2 åš´é‡ã€‚  
- **å…¶ä»–æŒ‡æ¨™**ï¼šAnemia ç´„ 0.10ï¼Œç›¸å°æ­£å¸¸ï¼›å…¶ä»–å¿ƒè¡€ç®¡é¢¨éšªæŒ‡æ¨™ä»‹æ–¼ä¸­é–“å€¼ã€‚  
- **PCA çµæœ**ï¼šPCA1 ç´„ -1.10ï¼ŒPCA2 ç´„ 0.59ï¼ŒPCA3 ç´„ -0.57ã€‚  
- **CKD æŒ‡æ¨™**ï¼šæ‰€æœ‰æ‚£è€…å‡ç‚º CKD (1.00)ï¼Œé¡¯ç¤ºå…¨ç¾¤çš†æœ‰æ…¢æ€§è…ç—…ã€‚  
- **é¢¨éšªåˆ†æ•¸**ï¼šå¹³å‡ç´„ 18.75ï¼ŒHigh_Risk ç´„ 0.61ï¼Œå±¬ä¸­åº¦é¢¨éšªã€‚

**ç¶œåˆè§£è®€**ï¼šCluster 3 æ‚£è€…é›–ç„¶ä¹Ÿå…¨ç‚º CKD æ‚£è€…ï¼Œä½†è…åŠŸèƒ½æå®³ç¨‹åº¦ï¼ˆä¾‹å¦‚è¡€æ¸…è‚Œé…ï¼‰è¼ƒ Cluster 2 è¼ƒè¼•ï¼›æ•´é«”è¡€ç³–ä»åé«˜ï¼Œå¯èƒ½å­˜åœ¨ä»£è¬ç•°å¸¸ï¼Œå±¬æ–¼ä¸­åº¦é¢¨éšªçµ„åˆ¥ï¼Œéœ€é€²ä¸€æ­¥èª¿æ•´æ²»ç™‚ç­–ç•¥ä»¥å»¶ç·©è…åŠŸèƒ½æƒ¡åŒ–ã€‚

---

**ç¸½çµ**ï¼š  
- **Cluster 0** ç‚ºä¸­è€å¹´ä¸”è…åŠŸèƒ½æœ‰ä¸­åº¦ç•°å¸¸çš„æ‚£è€…ç¾¤ï¼Œé¢¨éšªè¼ƒé«˜ã€‚  
- **Cluster 1** ç‚ºä½é¢¨éšªå¹´è¼•å¥åº·ç¾¤ï¼Œè…åŠŸèƒ½æ­£å¸¸ï¼Œé é˜²ç‚ºä¸»ã€‚  
- **Cluster 2** ç‚ºæ¥µé«˜é¢¨éšªç¾¤ï¼Œæ‚£è€…è…åŠŸèƒ½æ¥µå·®ï¼Œä»£è¬æŒ‡æ¨™åš´é‡ç•°å¸¸ã€‚  
- **Cluster 3** ç‚ºä¸­åº¦é¢¨éšªç¾¤ï¼Œé›–å…¨æ•¸ CKDï¼Œä½†æå®³ç¨‹åº¦ä»‹æ–¼ Cluster 0 èˆ‡ Cluster 2 ä¹‹é–“ã€‚

### 2.ç”¨çµ±è¨ˆæª¢å®š p å°å„çµ„æª¢æŸ¥
-ç›®çš„ï¼šæª¢æŸ¥å„ç¾¤åœ¨ä¸åŒè®Šæ•¸ä¸Šçš„å·®ç•°æ˜¯å¦é¡¯è‘—
"""

from scipy.stats import f_oneway

# å°é™¤äº† 'Cluster' æ¬„ä½ä¹‹å¤–çš„æ¯å€‹è®Šæ•¸é€²è¡Œ ANOVA æª¢å®š
for col in df_numeric.columns.drop('Cluster'):
    # ä¾ç¾¤åˆ¥æ”¶é›†æ¯å€‹è®Šæ•¸çš„æ•¸æ“š
    samples = [df_numeric[df_numeric['Cluster'] == k][col] for k in range(4)]
    f_val, p_val = f_oneway(*samples)  # åŸ·è¡Œ ANOVA æª¢å®š
    if p_val < 0.05:
        print(f"{col}: å·®ç•°é¡¯è‘— (p={p_val:.4f})")  # è‹¥ p < 0.05ï¼Œè¼¸å‡ºé¡¯è‘—æ€§çµæœ

"""é€™æŠ€è¡“ä¸Šä»£è¡¨é€™åˆ†ç¾¤ï¼Œç¢ºå¯¦åˆ‡å‡ºï¼Œä¸åŒçš„äººç¾¤ï¼ŒğŸš§ä½†å…¨éƒ¨éƒ½æ˜¯0å¾…ç¢ºèª

### 3.å°æ¯”å€‹ç¾¤çš„å·®ç•°
-ç›®çš„ï¼šé‡å°æ¯å€‹ç¾¤åˆ¥ï¼Œæ‰¾å‡ºè®Šç•°æ€§æœ€å¤§çš„ top_k ç‰¹å¾µä¸¦ç”Ÿæˆæ–‡å­—æè¿°
"""

def cluster_profiling(df, cluster_col='Cluster', top_k=5):
    profile = df.groupby(cluster_col).mean().T  # è½‰ç½®ï¼šè¡Œç‚ºè®Šæ•¸ï¼Œåˆ—ç‚ºç¾¤çµ„
    variability = profile.var(axis=1).sort_values(ascending=False)  # è¨ˆç®—æ¯å€‹è®Šæ•¸åœ¨å„ç¾¤é–“çš„è®Šç•°æ€§

    report = []
    # ä¾åºè™•ç†æ¯å€‹ç¾¤åˆ¥
    for cluster in sorted(df[cluster_col].unique()):
        dominant_features = variability.head(top_k).index.tolist()  # å–è®Šç•°æ€§æœ€å¤§çš„ top_k ç‰¹å¾µ
        description = f"Cluster {cluster} ç‰¹å¾µæ˜é¡¯è®ŠåŒ–ï¼š"
        for feat in dominant_features:
            mean_val = profile.loc[feat, cluster]  # å–å¾—ç‰¹å¾µåœ¨è©²ç¾¤çš„å¹³å‡å€¼
            description += f"{feat} å‡å€¼ {mean_val:.2f}ï¼Œ"  # çµ„åˆæ–‡å­—æè¿°
        report.append(description.strip('ï¼Œ'))  # å»é™¤å°¾ç«¯å¤šé¤˜çš„é€—è™Ÿ
    return report

# ç”¢ç”Ÿå„ç¾¤ç‰¹å¾µå·®ç•°å ±å‘Šä¸¦è¼¸å‡º
profiling_report = cluster_profiling(df_numeric)
for line in profiling_report:
    print(line)

"""**Cluster 0**  
- **ä¸»è¦ç‰¹å¾µ**ï¼š  
  - **White Blood Cells (WBC)**ï¼šå¹³å‡å€¼ç´„ 9910.70  
  - **Blood Urea**ï¼šå¹³å‡å€¼ç´„ 75.04 mgs/dL  
  - **Blood Glucose Random**ï¼šå¹³å‡å€¼ç´„ 186.05 mgs/dL  
  - **Risk_Score**ï¼šå¹³å‡å€¼ç´„ 24.84  
  - **Packed Cell Volume (PCV)**ï¼šå¹³å‡å€¼ç´„ 31.41  
- **çµæœèªªæ˜**ï¼š  
  æ­¤ç¾¤é«”çš„ç™½è¡€çƒæ•¸è¼ƒé«˜ï¼Œå¯èƒ½æš—ç¤ºå­˜åœ¨ä¸€å®šçš„ç‚ç—‡æˆ–æ„ŸæŸ“åæ‡‰ï¼›åŒæ™‚ï¼Œè¡€å°¿ç´ èˆ‡éš¨æ©Ÿè¡€ç³–æ•¸å€¼è¼ƒé«˜ï¼Œé¡¯ç¤ºè©²ç¾¤åœ¨è…åŠŸèƒ½èˆ‡ä»£è¬æ–¹é¢å¯èƒ½å­˜åœ¨ä¸€å®šçš„ç•°å¸¸ï¼›é¢¨éšªåˆ†æ•¸ä¸­ç­‰åé«˜ï¼Œè€Œ PCV åä½ï¼Œå¯èƒ½åæ˜ å‡ºè¡€æ¶²æ¿ƒç¸®åº¦é™ä½æˆ–è²§è¡€ç¾è±¡ã€‚ç¶œåˆä¾†çœ‹ï¼Œé€™ç¾¤æ‚£è€…å¯èƒ½å±¬æ–¼ä¸­é«˜é¢¨éšªï¼Œéœ€è¦é€²ä¸€æ­¥è¿½è¹¤èˆ‡ç®¡ç†ã€‚

---

**Cluster 1**  
- **ä¸»è¦ç‰¹å¾µ**ï¼š  
  - **White Blood Cells (WBC)**ï¼šå¹³å‡å€¼ç´„ 7770.14  
  - **Blood Urea**ï¼šå¹³å‡å€¼ç´„ 32.30 mgs/dL  
  - **Blood Glucose Random**ï¼šå¹³å‡å€¼ç´„ 109.32 mgs/dL  
  - **Risk_Score**ï¼šå¹³å‡å€¼ç´„ 10.98  
  - **Packed Cell Volume (PCV)**ï¼šå¹³å‡å€¼ç´„ 44.98  
- **çµæœèªªæ˜**ï¼š  
  æ­¤ç¾¤é«”å„é …æŒ‡æ¨™å‡è™•æ–¼è¼ƒä½æ°´æº–ï¼Œç™½è¡€çƒæ•¸ã€è¡€å°¿ç´ èˆ‡éš¨æ©Ÿè¡€ç³–éƒ½ç›¸å°æ­£å¸¸ï¼Œä¸”é¢¨éšªåˆ†æ•¸æœ€ä½ï¼ŒPCV åè€Œè¼ƒé«˜ï¼Œé¡¯ç¤ºè©²ç¾¤æ‚£è€…çš„è¡€æ¶²ç‹€æ…‹è¼ƒä½³ï¼Œæ•´é«”å¥åº·é¢¨éšªè¼ƒä½ã€‚é€™ç¾¤å¯èƒ½å±¬æ–¼ä½é¢¨éšªã€è¼ƒå¥åº·çš„ç¾¤é«”ã€‚

---

**Cluster 2**  
- **ä¸»è¦ç‰¹å¾µ**ï¼š  
  - **White Blood Cells (WBC)**ï¼šå¹³å‡å€¼ç´„ 7695.01  
  - **Blood Urea**ï¼šå¹³å‡å€¼ç´„ 141.04 mgs/dL  
  - **Blood Glucose Random**ï¼šå¹³å‡å€¼ç´„ 159.78 mgs/dL  
  - **Risk_Score**ï¼šå¹³å‡å€¼ç´„ 48.12  
  - **Packed Cell Volume (PCV)**ï¼šå¹³å‡å€¼ç´„ 25.89  
- **çµæœèªªæ˜**ï¼š  
  é›–ç„¶æ­¤ç¾¤çš„ç™½è¡€çƒæ•¸è¼ƒä½ï¼Œä½†è¡€å°¿ç´ é¡¯è‘—åé«˜ï¼Œé¡¯ç¤ºè…åŠŸèƒ½å¯èƒ½åš´é‡å—æï¼›éš¨æ©Ÿè¡€ç³–ä¹Ÿåé«˜ï¼Œä½†ç›¸æ¯”ä¹‹ä¸‹ï¼Œé¢¨éšªåˆ†æ•¸æœ€é«˜ä¸” PCV è¼ƒä½ï¼Œé€™äº›çµæœå…±åŒæš—ç¤ºæ­¤ç¾¤å±¬æ–¼é«˜é¢¨éšªç¾¤ï¼Œå¯èƒ½éœ€è¦å¯†åˆ‡ç›£æ§èˆ‡ç©æ¥µæ²»ç™‚ï¼Œä»¥æ”¹å–„è…åŠŸèƒ½åŠæ•´é«”ä»£è¬ç‹€æ…‹ã€‚

---

**Cluster 3**  
- **ä¸»è¦ç‰¹å¾µ**ï¼š  
  - **White Blood Cells (WBC)**ï¼šå¹³å‡å€¼ç´„ 8979.57  
  - **Blood Urea**ï¼šå¹³å‡å€¼ç´„ 55.93 mgs/dL  
  - **Blood Glucose Random**ï¼šå¹³å‡å€¼ç´„ 184.34 mgs/dL  
  - **Risk_Score**ï¼šå¹³å‡å€¼ç´„ 18.75  
  - **Packed Cell Volume (PCV)**ï¼šå¹³å‡å€¼ç´„ 35.32  
- **çµæœèªªæ˜**ï¼š  
  æ­¤ç¾¤çš„ç™½è¡€çƒæ•¸åŠéš¨æ©Ÿè¡€ç³–æ•¸å€¼å‡è™•æ–¼ä¸­é«˜æ°´æº–ï¼Œè¡€å°¿ç´ ç›¸å°è¼ƒä½ï¼›é¢¨éšªåˆ†æ•¸ä¸­ç­‰ï¼Œä½† PCV ä¹Ÿåä¸­ä½ï¼Œå¯èƒ½è¡¨ç¤ºè©²ç¾¤å­˜åœ¨ä¸€å®šç¨‹åº¦çš„ä»£è¬èˆ‡è…åŠŸèƒ½ç•°å¸¸ï¼Œä½†æœªé”æ¥µç«¯ç‹€æ…‹ã€‚æ•´é«”ä¾†çœ‹ï¼Œæ­¤ç¾¤å±¬æ–¼ä¸­ç­‰é¢¨éšªï¼Œéœ€æ³¨æ„ç›¸é—œæŒ‡æ¨™çš„è®ŠåŒ–ï¼ŒåŠæ—©å¹²é ä»¥é˜²ç—…æƒ…æƒ¡åŒ–ã€‚

---

**ç¸½çµèªªæ˜**ï¼š  
å„ç¾¤åœ¨ä¸»è¦è‡¨åºŠèˆ‡å¯¦é©—å®¤æŒ‡æ¨™ä¸Šå‡å­˜åœ¨é¡¯è‘—å·®ç•°ï¼Œé€™èªªæ˜åˆ†ç¾¤æ–¹æ³•èƒ½å¤ æœ‰æ•ˆå€åˆ†ä¸åŒå¥åº·ç‹€æ…‹çš„æ‚£è€…ï¼š
- **Cluster 0** é¡¯ç¤ºä¸­é«˜é¢¨éšªç‰¹å¾µï¼Œæç¤ºéœ€è¦é€²ä¸€æ­¥çš„ç›£æ§èˆ‡å¹²é ã€‚
- **Cluster 1** è¡¨ç¾å‡ºç›¸å°ç†æƒ³çš„å¥åº·ç‹€æ…‹ï¼Œå±¬æ–¼ä½é¢¨éšªç¾¤ã€‚
- **Cluster 2** å‰‡é¡¯ç¤ºæ¥µé«˜é¢¨éšªï¼Œå°¤å…¶åœ¨è…åŠŸèƒ½æ–¹é¢å¯èƒ½å­˜åœ¨åš´é‡å•é¡Œã€‚
- **Cluster 3** å±¬æ–¼ä¸­ç­‰é¢¨éšªï¼Œéœ€è¦é€²ä¸€æ­¥è©•ä¼°èˆ‡æŒçºŒè¿½è¹¤ã€‚

### 4.PCA äºŒç¶­è¦–è¦ºåŒ–
 -æ®µè½ç›®çš„ï¼šå°‡é«˜ç¶­æ•¸æ“šæŠ•å½±åˆ° 2 ç¶­ç©ºé–“ï¼Œä¸¦åœ¨æ•£é»åœ–ä¸Šé¡¯ç¤ºå„ç¾¤åˆ†ä½ˆåŠç¾¤ä¸­å¿ƒã€‚
"""

from sklearn.decomposition import PCA
import plotly.express as px
import plotly.graph_objects as go

# é€²è¡Œ PCA é™ç¶­åˆ° 2 ç¶­
pca = PCA(n_components=2)
pca_result = pca.fit_transform(X_scaled)
df_numeric['PCA1'] = pca_result[:, 0]  # ç¬¬ä¸€ä¸»æˆåˆ†
df_numeric['PCA2'] = pca_result[:, 1]  # ç¬¬äºŒä¸»æˆåˆ†

# å°‡ç¾¤ä¸­å¿ƒä¹ŸæŠ•å½±åˆ° PCA ç©ºé–“
centroids_pca = pca.transform(kmeans.cluster_centers_)

# ç¹ªè£½ 2D æ•£é»åœ–
fig = px.scatter(
    df_numeric,
    x='PCA1',
    y='PCA2',
    color='Cluster',
    title='KMeans 2D Clustering with Centroids',
    hover_data=df_numeric.columns  # æ»‘é¼ æ‡¸åœé¡¯ç¤ºæ‰€æœ‰è®Šæ•¸
)
# åŠ å…¥ç¾¤ä¸­å¿ƒæ¨™è¨˜
fig.add_trace(go.Scatter(
    x=centroids_pca[:, 0],
    y=centroids_pca[:, 1],
    mode='markers+text',
    marker=dict(color='black', size=12, symbol='x'),
    text=[f'Center {i}' for i in range(len(centroids_pca))],
    textposition="top center",
    name='Cluster Centers',
    showlegend=False
))
fig.show()

"""ç¾¤çµ„åˆ†é›¢æ˜é¡¯

å¾æ•£é»åœ–ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œå„ç¾¤ï¼ˆç”¨ä¸åŒé¡è‰²å€åˆ†ï¼‰åœ¨ PCA1 èˆ‡ PCA2 çš„å¹³é¢ä¸Šæœ‰æ˜é¡¯åˆ†é›¢ï¼Œé€™è¡¨æ˜é™ç¶­å¾Œçš„å…©å€‹ä¸»è¦æˆåˆ†èƒ½å¤ æ•æ‰åˆ°æ•¸æ“šä¸­å€åˆ†ç¾¤çµ„çš„é‡è¦è®Šç•°æ€§ã€‚

å„ç¾¤ä¹‹é–“æ²’æœ‰æ˜é¡¯é‡ç–Šï¼Œèªªæ˜ K-means åˆ†ç¾¤çµæœèƒ½å¤ æœ‰æ•ˆå€åˆ†ä¸åŒçš„æ‚£è€…ç¾¤é«”ã€‚

ç¾¤ä¸­å¿ƒä½ç½®

åœ–ä¸­ä»¥é»‘è‰² â€œxâ€ æ¨™è¨˜é¡¯ç¤ºäº†å„ç¾¤çš„ç¾¤ä¸­å¿ƒï¼ˆcentroidsï¼‰ã€‚

ç¾¤ä¸­å¿ƒä½ç½®èˆ‡å„ç¾¤æ•¸æ“šé»çš„åˆ†ä½ˆåŸºæœ¬å»åˆï¼Œé€²ä¸€æ­¥è­‰å¯¦äº†åˆ†ç¾¤çµæœçš„åˆç†æ€§ã€‚ç¾¤ä¸­å¿ƒé€šå¸¸ä½æ–¼å„ç¾¤æ•¸æ“šé»çš„é›†ä¸­å€åŸŸï¼Œä»£è¡¨è©²ç¾¤çš„ä»£è¡¨æ€§ç‰¹å¾µã€‚

æ•¸æ“šé™ç¶­æ•ˆæœ

PCA é™ç¶­å°‡åŸå§‹å¤šç¶­ç‰¹å¾µæŠ•å½±åˆ° 2 ç¶­å¹³é¢å¾Œï¼Œä¾ç„¶èƒ½å¤ æ¸…æ™°å€åˆ†ç¾¤çµ„ï¼Œè¡¨ç¤ºå‰å…©å€‹ä¸»æˆåˆ†èƒ½å¤ è§£é‡‹å¤§éƒ¨åˆ†æ•¸æ“šçš„è®Šç•°ï¼Œé€™å°æ–¼å¾ŒçºŒè¦–è¦ºåŒ–åŠè§£è®€å…·æœ‰é‡è¦æ„ç¾©ã€‚

### 5.PCA ä¸‰ç¶­è¦–è¦ºåŒ–
-æ®µè½ç›®çš„ï¼šé€²ä¸€æ­¥å°‡æ•¸æ“šé™ç¶­åˆ° 3 ç¶­ï¼Œç”Ÿæˆä¸‰ç¶­æ•£é»åœ–ï¼Œæ–¹ä¾¿è§€å¯Ÿç¾¤çµ„åˆ†ä½ˆåŠç¾¤ä¸­å¿ƒä½ç½®ã€‚
"""

# é€²è¡Œ PCA é™ç¶­åˆ° 3 ç¶­
pca = PCA(n_components=3)
pca_result = pca.fit_transform(X_scaled)
df_numeric['PCA1'] = pca_result[:, 0]
df_numeric['PCA2'] = pca_result[:, 1]
df_numeric['PCA3'] = pca_result[:, 2]

# å°‡ç¾¤ä¸­å¿ƒè½‰æ›åˆ° 3 ç¶­ PCA ç©ºé–“
centroids_pca = pca.transform(kmeans.cluster_centers_)

# ç¹ªè£½ 3D æ•£é»åœ–
fig = px.scatter_3d(
    df_numeric,
    x='PCA1',
    y='PCA2',
    z='PCA3',
    color='Cluster',
    title='KMeans 3D Clustering with Centroids',
    hover_data=df_numeric.columns
)
# åŠ å…¥ç¾¤ä¸­å¿ƒæ¨™è¨˜
fig.add_trace(go.Scatter3d(
    x=centroids_pca[:, 0],
    y=centroids_pca[:, 1],
    z=centroids_pca[:, 2],
    mode='markers+text',
    marker=dict(size=8, color='black', symbol='x'),
    text=[f'Center {i}' for i in range(len(centroids_pca))],
    textposition="top center",
    name='Centroids',
    showlegend=False
))
fig.show()

"""### 6.å„ç¾¤æ ¸å¿ƒç‰¹å¾µé›·é”åœ– (æ¨™æº–åŒ–å¾Œ)
-æ®µè½ç›®çš„ï¼šä»¥é›·é”åœ–å±•ç¤ºå„ç¾¤åœ¨å¤šç¶­ç‰¹å¾µä¸Šçš„è¡¨ç¾ï¼Œä¾¿æ–¼ç›´è§€æ¯”è¼ƒã€‚
"""

from sklearn.preprocessing import MinMaxScaler
scaler = MinMaxScaler()

# è¨ˆç®—ç¾¤çµ„æ¦‚æ³ï¼ˆæ¯å€‹ç¾¤çµ„çš„æ¯å€‹ç‰¹å¾µçš„å¹³å‡å€¼ï¼‰
cluster_profile = df_numeric.groupby('Cluster').mean()

# å°‡ç¾¤çµ„å¹³å‡æ•¸æ“šæ­£è¦åŒ–
normalized_profile = pd.DataFrame(
    scaler.fit_transform(cluster_profile),
    index=cluster_profile.index,
    columns=cluster_profile.columns
)

# ç¹ªè£½é›·é”åœ–
import plotly.graph_objects as go
fig = go.Figure()
for cluster in normalized_profile.index:
    fig.add_trace(go.Scatterpolar(
        r=normalized_profile.loc[cluster].values,  # å–è©²ç¾¤æ‰€æœ‰ç‰¹å¾µæ­£è¦åŒ–å€¼
        theta=normalized_profile.columns,          # ç‰¹å¾µåç¨±ä½œç‚ºè§’åº¦æ¨™ç±¤
        fill='toself',
        name=f'Cluster {cluster}'
    ))
fig.update_layout(
    polar=dict(radialaxis=dict(visible=True, range=[0,1])),
    title="å„ç¾¤æ ¸å¿ƒç‰¹å¾µé›·é”åœ– (æ¨™æº–åŒ–å¾Œ)",
    showlegend=True
)
fig.show()

"""### 7.åˆ†ç¾¤å¾Œå¼•å…¥ CKD æ¬„ä½ä¸¦é€²è¡Œè…è‡Ÿç—…æ¯”ä¾‹åˆ†æ
-æ®µè½ç›®çš„ï¼šåœ¨åˆ†ç¾¤çµæœä¸­å¼•å…¥ Chronic Kidney Disease: yes æ¬„ä½ï¼Œä¸¦è¨ˆç®—å„ç¾¤ä¸­è…è‡Ÿç—…æ‚£è€…çš„æ¯”ä¾‹ã€‚
"""

df_numeric['Chronic Kidney Disease: yes'] = df_original.loc[df_numeric.index, 'Chronic Kidney Disease: yes']
ckd_counts = df_numeric.groupby('Cluster')['Chronic Kidney Disease: yes'].value_counts(normalize=True).unstack()
print("å„ç¾¤è…è‡Ÿç—…æ‚£è€…æ¯”ä¾‹ (Yes/No):")
print(ckd_counts)

"""### 8.ç¾¤é«”è¼ªå»“è¡¨
-é‡å°é—œéµé†«ç™‚è®Šæ•¸ç”Ÿæˆå„ç¾¤çš„å¹³å‡æ•¸ï¼Œä¸¦å°‡éƒ¨åˆ†ç™¾åˆ†æ¯”æ•¸æ“šæ ¼å¼åŒ–é¡¯ç¤ºï¼Œæ–¹ä¾¿å¾ŒçºŒæ¯”è¼ƒã€‚
"""

key_features = ['Serum Creatinine (mgs/dL)', 'Blood Urea (mgs/dL)', 'Potassium (mEq/L)',
                'Anemia: yes', 'Diabetes Mellitus: yes', 'Hypertension: yes']

# é‡å°é—œéµç‰¹å¾µé€²è¡Œç¾¤çµ„å¹³å‡å€¼è¨ˆç®—
cluster_medical_profile = df_numeric.groupby('Cluster')[key_features].mean().reset_index()

# å°‡ 'Diabetes Mellitus: yes' èˆ‡ 'Hypertension: yes' è½‰ç‚ºç™¾åˆ†æ¯”æ ¼å¼
for col in ['Diabetes Mellitus: yes', 'Hypertension: yes']:
    cluster_medical_profile[col] = (cluster_medical_profile[col] * 100).round(2).astype(str) + '%'

# é‡æ–°å‘½åæ¬„ä½ï¼Œä½¿å ±å‘Šæ›´æ˜“è®€
cluster_medical_profile.rename(columns={
    'Serum Creatinine (mgs/dL)': 'Creatinine',
    'Blood Urea (mgs/dL)': 'Blood Urea',
    'Potassium (mEq/L)': 'Potassium',
    'Anemia: yes': 'Anemia',
    'Diabetes Mellitus: yes': 'Diabetes Mellitus (%)',
    'Hypertension: yes': 'Hypertension (%)'
}, inplace=True)

# è¼¸å‡ºç¾¤é«”è¼ªå»“è¡¨
print(cluster_medical_profile)

"""Cluster 0

Creatinineï¼šå¹³å‡å€¼ç´„ 3.55 mgs/dLï¼Œé¡¯ç¤ºè…åŠŸèƒ½æœ‰ä¸­åº¦å—æçš„å¯èƒ½æ€§ã€‚

Blood Ureaï¼šå¹³å‡ç´„ 75.04 mgs/dLï¼Œæç¤ºè…è‡Ÿæ’æ¯’åŠŸèƒ½å¯èƒ½ç•°å¸¸ã€‚

Potassiumï¼šå¹³å‡ç´„ 4.42 mEq/Lï¼Œå±¬æ–¼æ­£å¸¸ç¯„åœï¼Œä½†ä»éœ€æ³¨æ„é›»è§£è³ªå¹³è¡¡ã€‚

Anemiaï¼šå¹³å‡å€¼ç´„ 0.30ï¼Œè¡¨ç¤ºç´„ 30% çš„æ‚£è€…å­˜åœ¨è²§è¡€ç¾è±¡ã€‚

Diabetes Mellitus (%)ï¼šç´„ 56.82%ï¼Œèªªæ˜è©²ç¾¤è¶…éä¸€åŠçš„æ‚£è€…æœ‰ç³–å°¿ç—…ç—…å²æˆ–ç³–å°¿ç—…é¢¨éšªã€‚

Hypertension (%)ï¼šç´„ 65.91%ï¼Œé¡¯ç¤ºé«˜è¡€å£“çš„æ¯”ä¾‹ä¹Ÿç›¸ç•¶é«˜ã€‚

è§£è®€ï¼šCluster 0 çš„æ‚£è€…ç¾¤ä¸­ï¼Œè…åŠŸèƒ½æŒ‡æ¨™ï¼ˆCreatinine èˆ‡ Blood Ureaï¼‰ç•°å¸¸ï¼Œä¸”ç³–å°¿ç—…èˆ‡é«˜è¡€å£“æ¯”ä¾‹è¼ƒé«˜ï¼Œæç¤ºæ­¤ç¾¤æ‚£è€…å¯èƒ½å­˜åœ¨å¤šé‡ä»£è¬åŠå¿ƒè¡€ç®¡é¢¨éšªï¼Œéœ€é‡å°è…åŠŸèƒ½èˆ‡æ…¢æ€§ç–¾ç—…åŠ å¼·ç®¡ç†ã€‚

Cluster 1

Creatinineï¼šå¹³å‡ç´„ 1.08 mgs/dLï¼Œå±¬æ–¼æ­£å¸¸ç¯„åœï¼Œé¡¯ç¤ºè…åŠŸèƒ½è¼ƒå¥½ã€‚

Blood Ureaï¼šå¹³å‡ç´„ 32.30 mgs/dLï¼Œè¼ƒä½ï¼Œæ”¯æŒè…åŠŸèƒ½æ­£å¸¸çš„åˆ¤æ–·ã€‚

Potassiumï¼šå¹³å‡ç´„ 4.27 mEq/Lï¼Œæ­£å¸¸ç¯„åœå…§ã€‚

Anemiaï¼šæ¥µä½ç´„ 0.01ï¼Œå¹¾ä¹ç„¡è²§è¡€ç¾è±¡ã€‚

Diabetes Mellitus (%)ï¼šåƒ… 1.58%ï¼Œå¹¾ä¹å¯ä»¥æ’é™¤ç³–å°¿ç—…é¢¨éšªã€‚

Hypertension (%)ï¼šåƒ… 2.11%ï¼Œé«˜è¡€å£“æ¯”ä¾‹æ¥µä½ã€‚

è§£è®€ï¼šCluster 1 çš„å„é …æŒ‡æ¨™å‡é¡¯ç¤ºæ­£å¸¸æˆ–æ¥è¿‘ç†æƒ³ç‹€æ…‹ï¼Œç„¡è«–æ˜¯è…åŠŸèƒ½ã€é›»è§£è³ªã€è²§è¡€ï¼Œæˆ–æ˜¯æ…¢æ€§ç–¾ç—…ï¼ˆç³–å°¿ç—…ã€é«˜è¡€å£“ï¼‰çš„æ¯”ä¾‹éƒ½éå¸¸ä½ï¼Œè¡¨æ˜è©²ç¾¤å±¬æ–¼ä½é¢¨éšªã€å¥åº·ç‹€æ…‹è‰¯å¥½çš„æ‚£è€…ç¾¤ã€‚

Cluster 2

Creatinineï¼šå¹³å‡ç´„ 11.13 mgs/dLï¼Œé¡¯è‘—åé«˜ï¼Œé¡¯ç¤ºè…åŠŸèƒ½åš´é‡å—æã€‚

Blood Ureaï¼šå¹³å‡ç´„ 141.04 mgs/dLï¼Œä¹Ÿæ˜é¡¯åé«˜ï¼Œèˆ‡è…åŠŸèƒ½æå®³ç›¸ç¬¦ã€‚

Potassiumï¼šå¹³å‡ç´„ 6.42 mEq/Lï¼Œé¡¯è‘—é«˜æ–¼æ­£å¸¸å€¼ï¼Œå¯èƒ½å°è‡´å¿ƒå¾‹ä¸æ•´ç­‰ä½µç™¼ç—‡ã€‚

Anemiaï¼šå¹³å‡ç´„ 0.70ï¼Œè²§è¡€æƒ…å½¢æ˜é¡¯ï¼Œç´„ 70% æ‚£è€…æœ‰è²§è¡€å•é¡Œã€‚

Diabetes Mellitus (%)ï¼šç´„ 61.7%ï¼Œç³–å°¿ç—…æ¯”ä¾‹åé«˜ã€‚

Hypertension (%)ï¼šç´„ 85.11%ï¼Œé¡¯ç¤ºé«˜è¡€å£“æ¥µç‚ºæ™®éã€‚

è§£è®€ï¼šCluster 2 æ‚£è€…çš„è…åŠŸèƒ½æ¥µå·®ï¼ˆCreatinine èˆ‡ Blood Urea æ˜é¡¯å‡é«˜ï¼‰ï¼Œä¸¦ä¼´æœ‰æ˜é¡¯çš„é›»è§£è³ªå¤±è¡¡ï¼ˆé«˜é‰€ï¼‰ã€é«˜æ¯”ä¾‹è²§è¡€ã€ç³–å°¿ç—…èˆ‡é«˜è¡€å£“ï¼Œè©²ç¾¤å±¬æ–¼æ¥µé«˜é¢¨éšªç¾¤ï¼Œéœ€å¯†åˆ‡ç›£æ§ä¸¦ç©æ¥µé€²è¡Œæ²»ç™‚å¹²é ã€‚

Cluster 3

Creatinineï¼šå¹³å‡ç´„ 2.72 mgs/dLï¼Œç•¥é«˜æ–¼æ­£å¸¸ä½†ä½æ–¼ Cluster 0 èˆ‡ 2ã€‚

Blood Ureaï¼šå¹³å‡ç´„ 55.93 mgs/dLï¼Œè¼ƒ Cluster 0 èˆ‡ Cluster 2 ä½ã€‚

Potassiumï¼šå¹³å‡ç´„ 4.38 mEq/Lï¼Œæ¥è¿‘æ­£å¸¸ç¯„åœã€‚

Anemiaï¼šå¹³å‡ç´„ 0.10ï¼Œè²§è¡€æƒ…å½¢è¼•å¾®ã€‚

Diabetes Mellitus (%)ï¼šç´„ 67.23%ï¼Œç³–å°¿ç—…æ¯”ä¾‹åé«˜ã€‚

Hypertension (%)ï¼šç´„ 62.18%ï¼Œé«˜è¡€å£“æ¯”ä¾‹ä¸­ç­‰ã€‚

è§£è®€ï¼šCluster 3 çš„è…åŠŸèƒ½æŒ‡æ¨™è¼•åº¦ç•°å¸¸ï¼ˆCreatinine ç•¥é«˜ï¼‰ï¼Œä½† Blood Urea è¼ƒä½ï¼Œé›»è§£è³ªèˆ‡è²§è¡€ç‹€æ³è¼ƒå¥½ï¼›ç„¶è€Œç³–å°¿ç—…èˆ‡é«˜è¡€å£“çš„æ¯”ä¾‹ä¾ç„¶åé«˜ï¼Œæç¤ºè©²ç¾¤å¯èƒ½å­˜åœ¨ä»£è¬èˆ‡å¿ƒè¡€ç®¡é¢¨éšªï¼Œä½†ç›¸è¼ƒæ–¼ Cluster 2ï¼Œé¢¨éšªç¨‹åº¦è¼ƒä½ï¼Œå±¬æ–¼ä¸­ç­‰é¢¨éšªç¾¤ã€‚

### 9.ç‰¹å¾µå·®ç•°ç†±åœ–
-æ®µè½ç›®çš„ï¼šå°‡å„ç¾¤ç‰¹å¾µæ•¸æ“šé€²è¡Œæ¨™æº–åŒ–å¾Œä»¥ç†±åœ–å±•ç¤ºï¼Œä¾¿æ–¼æ¯”è¼ƒå„ç¾¤å·®ç•°ã€‚
"""

from sklearn.preprocessing import MinMaxScaler
import plotly.express as px

scaler = MinMaxScaler()
cluster_profile_scaled = pd.DataFrame(
    scaler.fit_transform(cluster_profile),  # å°‡ç¾¤çµ„å¹³å‡å€¼æ­£è¦åŒ–åˆ° 0~1 ç¯„åœ
    index=cluster_profile.index,
    columns=cluster_profile.columns
)

# ä½¿ç”¨ px.imshow ç•«å‡ºç†±åœ–
fig = px.imshow(
    cluster_profile_scaled.T,  # è½‰ç½®å¾Œç‰¹å¾µä½œç‚º y è»¸ï¼Œç¾¤çµ„ä½œç‚º x è»¸
    text_auto=".2f",
    color_continuous_scale='RdBu_r',
    aspect="auto"
)
fig.update_layout(
    title="Cluster Feature Heatmap (0~1 Scaled)",
    width=1400,
    height=900,
    xaxis_title="Cluster",
    yaxis_title="Feature",
    coloraxis_colorbar=dict(title="Scaled Value (0~1)")
)
fig.update_xaxes(type='category')
fig.show()

"""### 10.é¢¨éšªåˆ†æ•¸è¨ˆç®—èˆ‡é¢¨éšªæ’å
-æ®µè½ç›®çš„ï¼šæ ¹æ“šå¤šå€‹é—œéµè®Šæ•¸è¨ˆç®—æ¯å€‹æ‚£è€…çš„é¢¨éšªåˆ†æ•¸ï¼Œä¸¦ç”Ÿæˆé¢¨éšªæ’åèˆ‡å„ç¾¤é¢¨éšªçµ±è¨ˆã€‚
"""

# è¨ˆç®—é¢¨éšªåˆ†æ•¸ï¼šæ ¹æ“šä¸åŒè®Šæ•¸åŠ æ¬Š
df_numeric['Risk_Score'] = (
    0.4 * df_numeric['Serum Creatinine (mgs/dL)'] +
    0.3 * df_numeric['Blood Urea (mgs/dL)'] +
    0.2 * df_numeric['Potassium (mEq/L)'] +
    0.1 * df_numeric['Anemia: yes']
)

# æ ¹æ“šé¢¨éšªåˆ†æ•¸é€²è¡Œæ’åºï¼Œå–å‡ºé¢¨éšªæœ€é«˜çš„å‰ 10 å
df_risk_ranked = df_numeric.sort_values(by='Risk_Score', ascending=False).reset_index(drop=True)

# ä¾ç¾¤åˆ¥è¨ˆç®—é¢¨éšªåˆ†æ•¸çµ±è¨ˆç‰¹å¾µ
cluster_risk_profile = df_numeric.groupby('Cluster')['Risk_Score'].agg(['mean', 'max', 'min', 'count']).reset_index()

print("ã€é¢¨éšªæ’åå‰10ã€‘")
print(df_risk_ranked[['Risk_Score', 'Serum Creatinine (mgs/dL)', 'Blood Urea (mgs/dL)', 'Potassium (mEq/L)', 'Anemia: yes', 'Cluster']].head(10))

print("\nã€å„ Cluster é¢¨éšªè¼ªå»“ã€‘")
cluster_risk_profile

"""1. é¢¨éšªåˆ†æ•¸è¨ˆç®—

ç¨‹å¼ç¢¼ä¸­æ ¹æ“šä¸‹åˆ—æ¬Šé‡è¨ˆç®—æ¯ä½æ‚£è€…çš„é¢¨éšªåˆ†æ•¸ï¼š

40% ä¾†è‡ªæ–¼ Serum Creatinine (mgs/dL)

30% ä¾†è‡ªæ–¼ Blood Urea (mgs/dL)

20% ä¾†è‡ªæ–¼ Potassium (mEq/L)

10% ä¾†è‡ªæ–¼ Anemia: yes

é€™æ¨£çš„åŠ æ¬Šæ–¹å¼åæ˜ å‡ºå°æ–¼è…åŠŸèƒ½æŒ‡æ¨™ï¼ˆä¾‹å¦‚è‚Œé…èˆ‡å°¿ç´ ï¼‰çš„é‡è¦–ï¼Œä¸¦å°‡é›»è§£è³ªèˆ‡è²§è¡€ç‹€æ³ç´å…¥è€ƒé‡ã€‚

2. é¢¨éšªæ’åºèˆ‡æ’å

åˆ©ç”¨è¨ˆç®—å‡ºçš„ Risk_Scoreï¼Œç¨‹å¼ç¢¼å°æ‰€æœ‰æ‚£è€…é€²è¡Œæ’åºï¼Œä¸¦å–å‡ºé¢¨éšªåˆ†æ•¸æœ€é«˜çš„å‰ 10 åã€‚

æ­¤æ’åºçµæœæœ‰åŠ©æ–¼è­˜åˆ¥å“ªäº›æ‚£è€…çš„é¢¨éšªæŒ‡æ•¸è¼ƒé«˜ï¼Œæä¾›è‡¨åºŠæ±ºç­–æ™‚çš„åƒè€ƒä¾æ“šã€‚

3. å„ç¾¤é¢¨éšªçµ±è¨ˆ

ç¨‹å¼ç¢¼åŒæ™‚ä¾ç…§åˆ†ç¾¤çµæœï¼ˆClusterï¼‰çµ±è¨ˆ Risk_Score çš„å¹³å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼åŠæ‚£è€…æ•¸é‡ã€‚

é€™éƒ¨åˆ†å¯ç”¨ä¾†æ¯”è¼ƒä¸åŒç¾¤çµ„çš„é¢¨éšªæ°´æº–ï¼Œäº†è§£å„ç¾¤çš„é¢¨éšªåˆ†å¸ƒæƒ…æ³ï¼Œä¾‹å¦‚å“ªäº›ç¾¤çµ„çš„é¢¨éšªè¼ƒé«˜ã€æ³¢å‹•è¼ƒå¤§æˆ–æ‚£è€…æ•¸è¼ƒå°‘ç­‰ã€‚

## æ±ºç­–æ¨¹ ğŸš§æš«æ£„
"""

# @title
# from sklearn.tree import DecisionTreeClassifier, plot_tree
# features = [
#     'Diabetes Mellitus: yes',
#     'Serum Creatinine (mgs/dL)',
#     'Blood Urea (mgs/dL)',
#     'Potassium (mEq/L)',
#     'Anemia: yes',
#     'Blood Pressure (mm/Hg)',
#     'Hypertension: yes',
#     'Age (yrs)'
# ]


# df_numeric['High_Risk'] = (df_numeric['Risk_Score'] > df_numeric['Risk_Score'].median()).astype(int)


# clf = DecisionTreeClassifier(max_depth=4, random_state=42)
# clf.fit(df_numeric[features], df_numeric['High_Risk'])


# plt.figure(figsize=(24, 12))
# plot_tree(
#     clf,
#     feature_names=features,
#     class_names=['Low Risk', 'High Risk'],
#     filled=True,
#     rounded=True,
#     fontsize=12
# )
# plt.title("Risk Decision Tree - Pathological Process Recovery")
# plt.show()

"""## å…­ã€æ ¹æ“šåˆ†ç¾¤çµæœé€²è¡Œç¾¤çµ„å‘½åèˆ‡é†«ç™‚å»ºè­°

### 1.ç¾¤çµ„å‘½å
-æ®µè½ç›®çš„ï¼šä¾æ“šå„ç¾¤çµ±è¨ˆç‰¹å¾µï¼ˆå¦‚ CKD æ¯”ä¾‹ã€å¹´é½¡ã€è¡€å£“ç­‰ï¼‰çµ¦å‡ºé©ç•¶çš„ç¾¤çµ„å‘½åã€‚
"""

import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd

def analyze_clusters(df_original, df_numeric):
    # åˆä½µ CKD è³‡è¨Š
    df_numeric = df_numeric.copy()
    df_numeric['Chronic Kidney Disease: yes'] = df_original.loc[df_numeric.index, 'Chronic Kidney Disease: yes']

    # è¨ˆç®—æ¯ç¾¤çš„ CKD æ¯”ä¾‹
    cluster_ckd_ratio = df_numeric.groupby('Cluster')['Chronic Kidney Disease: yes'].value_counts(normalize=True).unstack()
    print("å„ç¾¤è…è‡Ÿç—…æ‚£è€…æ¯”ä¾‹ï¼š")
    print(cluster_ckd_ratio)

    # è¨ˆç®—æ¯ç¾¤çš„ç‰¹å¾µæ•¸æ“š
    cluster_features = df_numeric.groupby('Cluster').agg(['mean', 'median', 'std'])
    print("å„ç¾¤æ•¸æ“šç‰¹å¾µï¼š")
    print(cluster_features)

    # è¦–è¦ºåŒ– CKD æ¯”ä¾‹
    plt.figure(figsize=(8, 6))
    cluster_ckd_ratio.plot(kind='bar', stacked=True, colormap='coolwarm', edgecolor='black')
    plt.title("å„ç¾¤è…è‡Ÿç—…æ‚£è€…æ¯”ä¾‹",fontproperties=font_prop)
    plt.xlabel("ç¾¤çµ„",fontproperties=font_prop)
    plt.ylabel("æ¯”ä¾‹",fontproperties=font_prop)
    plt.legend(title='CKD', labels=['No', 'Yes'])
    plt.show()

    return cluster_features

cluster_features = analyze_clusters(df_original, df_numeric)

def name_clusters(cluster_features):
    cluster_names = {}  # å­˜æ”¾å„ç¾¤åç¨±çš„å­—å…¸
    # ä¾åºè™•ç†æ¯å€‹ç¾¤çµ„çš„çµ±è¨ˆæ•¸æ“š
    for cluster, features in cluster_features.iterrows():
        # åˆ¤æ–·è©²ç¾¤ CKD æ¯”ä¾‹æ˜¯å¦ç‚º 100%
        if features[('Chronic Kidney Disease: yes', 'mean')] == 1.0:
            # å¦‚æœè©²ç¾¤å¹³å‡å¹´é½¡å¤§æ–¼æˆ–ç­‰æ–¼ 58 æ­²ï¼Œå‘½åç‚ºã€Œè€å¹´æ…¢æ€§è…ç—…ç¾¤ã€
            if features[('Age (yrs)', 'mean')] >= 58:
                name = "è€å¹´æ…¢æ€§è…ç—…ç¾¤"
            # è‹¥è¡€å£“å¹³å‡å€¼å¤§æ–¼æˆ–ç­‰æ–¼ 80ï¼Œå‘½åç‚ºã€Œé«˜è¡€å£“è…ç—…ç¾¤ã€
            elif features[('Blood Pressure (mm/Hg)', 'mean')] >= 80:
                name = "é«˜è¡€å£“é‡åº¦è…ç—…ç¾¤"
            # å…¶ä»–æƒ…æ³ä¸‹ï¼Œå‘½åç‚ºã€Œé‡åº¦è…è‡Ÿç—…æ‚£è€…ç¾¤ã€
            else:
                name = "é‡åº¦è…è‡Ÿç—…æ‚£è€…ç¾¤"
        else:
            # CKD æ¯”ä¾‹ä¸ç‚º 100% çš„ç¾¤çµ„ï¼Œå‘½åç‚ºã€Œä½é¢¨éšªå¹´è¼•å¥åº·ç¾¤ã€
            name = "ä½é¢¨éšªå¹´è¼•å¥åº·ç¾¤"
        cluster_names[cluster] = name  # å„²å­˜ç¾¤çµ„åç¨±
    return cluster_names

# å‘¼å«ç¾¤çµ„å‘½åå‡½å¼ï¼Œä¸¦è¼¸å‡ºçµæœ
cluster_names = name_clusters(cluster_features)
for cluster, name in cluster_names.items():
    print(f"ç¾¤çµ„ {cluster}: {name}")

"""### 2.ä¾ç…§å‘½åå¾Œçš„åˆ†çµ„æå‡ºé†«ç™‚å»ºè­°èˆ‡è¡›æ•™æ–¹å¼"""

def medical_advice_for_clusters(cluster_names, cluster_features):
    cluster_advice = {}  # å­˜æ”¾å„ç¾¤é†«ç™‚å»ºè­°çš„å­—å…¸
    # æ ¹æ“šæ¯å€‹ç¾¤çš„åç¨±ä¾†æ±ºå®šå»ºè­°å…§å®¹
    for cluster, name in cluster_names.items():
        if name == "é‡åº¦è…è‡Ÿç—…æ‚£è€…ç¾¤":
            advice = (
                "æ­¤ç¾¤æ‚£è€…é›–å±¬ä¸­åº¦è…åŠŸèƒ½ç•°å¸¸ç¾¤ï¼Œä½†ä»é¡¯ç¤ºè¼ƒæ˜é¡¯çš„è…è‡Ÿæå®³ï¼ˆè¡€æ¸…è‚Œé…å¹³å‡ç´„ 3.55 mgs/dLï¼‰ã€‚\n"
                "å»ºè­°ï¼š\n"
                "1. åš´æ ¼é™åˆ¶è›‹ç™½è³ªæ”å…¥ï¼Œæ¡ç”¨ä½é¹½ã€ä½è›‹ç™½é£²é£Ÿï¼Œä»¥æ¸›è¼•è…è‡Ÿè² æ“”ã€‚\n"
                "2. å®šæœŸç›£æ¸¬è…åŠŸèƒ½æŒ‡æ¨™ï¼ˆå¦‚è‚Œé…ã€å°¿ç´ åŠé›»è§£è³ªï¼‰ï¼Œä»¥ä¾¿æ—©æœŸç™¼ç¾ç—…æƒ…æƒ¡åŒ–ã€‚\n"
                "3. èˆ‡è…è‡Ÿç§‘é†«å¸«å¯†åˆ‡åˆä½œï¼Œè©•ä¼°æ˜¯å¦éœ€è¦é€²ä¸€æ­¥èª¿æ•´æ²»ç™‚æ–¹æ¡ˆï¼Œä¸¦è€ƒæ…®ä½¿ç”¨è…ä¿è­·è—¥ç‰©ã€‚\n"
                "4. åŠ å¼·å¥åº·è¡›æ•™ï¼Œæé†’æ‚£è€…æˆ’é™¤ä¸è‰¯å—œå¥½ï¼Œæ§åˆ¶è¡€ç³–èˆ‡è¡€å£“ï¼Œç¶­æŒè‰¯å¥½çš„ç”Ÿæ´»ç¿’æ…£ã€‚"
            )
        elif name == "ä½é¢¨éšªå¹´è¼•å¥åº·ç¾¤":
            advice = (
                "æ­¤ç¾¤æ‚£è€…å¹´é½¡åè¼•ï¼ˆå¹³å‡ç´„ 44 æ­²ï¼‰ï¼Œè‡¨åºŠæŒ‡æ¨™å‡æ¥è¿‘æ­£å¸¸æ°´æº–ï¼Œé¢¨éšªä½ã€‚\n"
                "å»ºè­°ï¼š\n"
                "1. ç¶­æŒå‡è¡¡é£²é£Ÿå’Œè¦å¾‹é‹å‹•ï¼Œä¿æŒç†æƒ³é«”é‡ï¼Œä¿ƒé€²å¿ƒè¡€ç®¡åŠè…åŠŸèƒ½å¥åº·ã€‚\n"
                "2. å®šæœŸé€²è¡Œå¥åº·æª¢æŸ¥ï¼ŒåŒ…æ‹¬è¡€å£“ã€è¡€ç³–å’Œè…åŠŸèƒ½è©•ä¼°ï¼Œä»¥é é˜²æœªä¾†æ…¢æ€§ç–¾ç—…ç™¼ç”Ÿã€‚\n"
                "3. åŠ å¼·è¡›æ•™ï¼Œå»ºç«‹å¥åº·ç”Ÿæ´»æ¨¡å¼ï¼Œé¿å…ç†¬å¤œå’Œå¸è¸ç­‰ä¸è‰¯ç¿’æ…£ã€‚"
            )
        elif name == "é«˜è¡€å£“é‡åº¦è…ç—…ç¾¤":
            advice = (
                "æ­¤ç¾¤æ‚£è€…å‘ˆç¾æ¥µé«˜çš„è…åŠŸèƒ½æå®³ï¼ˆè¡€æ¸…è‚Œé…å¹³å‡ç´„ 11.13 mgs/dLï¼‰ï¼Œä¸¦ä¼´éš¨åš´é‡çš„é«˜è¡€å£“ï¼ˆHypertension ç´„ 85%ï¼‰ã€‚\n"
                "å»ºè­°ï¼š\n"
                "1. å¿…é ˆåš´æ ¼æ§åˆ¶è¡€å£“ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ ACEI æˆ– ARB é¡è—¥ç‰©ä¾†ä¿è­·è…è‡ŸåŠŸèƒ½ã€‚\n"
                "2. æ¡ç”¨ä½é¹½ã€ä½è›‹ç™½é£²é£Ÿï¼Œä¸¦å¯†åˆ‡ç›£æ§è¡€å°¿ç´ ã€è‚Œé…åŠé‰€å«é‡ï¼Œé˜²æ­¢é›»è§£è³ªå¤±è¡¡ã€‚\n"
                "3. å®šæœŸæ¥å—è…åŠŸèƒ½æª¢æŸ¥ï¼Œæ ¹æ“šæª¢æŸ¥çµæœåŠæ™‚èª¿æ•´æ²»ç™‚æ–¹æ¡ˆï¼Œä¸¦ç©æ¥µé€²è¡Œç‡Ÿé¤Šè«®è©¢ã€‚\n"
                "4. è¡›æ•™ä¸Šéœ€ç‰¹åˆ¥å¼·èª¿è—¥ç‰©æœç”¨çš„é‡è¦æ€§åŠæ—¥å¸¸ç”Ÿæ´»ç®¡ç†ï¼Œé¿å…éåº¦å‹ç´¯ã€‚"
            )
        elif name == "è€å¹´æ…¢æ€§è…ç—…ç¾¤":
            advice = (
                "æ­¤ç¾¤æ‚£è€…å¹´é½¡è¼ƒé«˜ï¼ˆå¹³å‡ç´„ 59 æ­²ï¼‰ï¼Œå¸¸ä¼´éš¨å¤šé‡æ…¢æ€§ç—…ï¼ˆå¦‚ç³–å°¿ç—…èˆ‡é«˜è¡€å£“ï¼‰ï¼Œè…åŠŸèƒ½äº¦å‘ˆç¾è¼•åº¦ç•°å¸¸ã€‚\n"
                "å»ºè­°ï¼š\n"
                "1. å®šæœŸé€²è¡Œå…¨é¢å¥åº·æª¢æŸ¥ï¼Œç‰¹åˆ¥æ˜¯è…åŠŸèƒ½ã€è¡€å£“èˆ‡è¡€ç³–çš„ç›£æ¸¬ï¼ŒåŠæ—©ç™¼ç¾åŠæ²»ç™‚å…±ç—…ã€‚\n"
                "2. æ¡ç”¨å€‹åˆ¥åŒ–çš„ä½é¹½ã€ä½è›‹ç™½é£²é£Ÿï¼Œä¸¦åœ¨ç‡Ÿé¤Šå¸«æŒ‡å°ä¸‹æ”¹å–„é£²é£Ÿçµæ§‹ï¼Œç¢ºä¿ç‡Ÿé¤Šå‡è¡¡ã€‚\n"
                "3. é¼“å‹µé©åº¦é‹å‹•ï¼Œå¦‚å¤ªæ¥µã€æ•£æ­¥ç­‰ï¼Œä»¥ä¿ƒé€²è¡€æ¶²å¾ªç’°å’Œå¢å¼·é«”èƒ½ï¼Œä½†é¿å…éåº¦è² è·ã€‚\n"
                "4. è¡›æ•™ä¸Šè¦æé†’æ‚£è€…æ³¨æ„æ­£ç¢ºæœè—¥ï¼Œé¿å…è—¥ç‰©é–“çš„ä¸è‰¯äº’å‹•ï¼Œä¸¦ä¿æŒè‰¯å¥½çš„ç”Ÿæ´»ä½œæ¯ã€‚"
            )
        else:
            advice = "è«‹æ ¹æ“šå¯¦éš›ç‹€æ³é€²è¡Œé€²ä¸€æ­¥è©•ä¼°èˆ‡å»ºè­°ã€‚"
        cluster_advice[name] = advice  # ç›´æ¥ä»¥åç¨±ä½œç‚º key å„²å­˜å»ºè­°å…§å®¹

    return cluster_advice

# å‘¼å«é†«ç™‚å»ºè­°å‡½å¼ï¼Œä¸¦è¼¸å‡ºå„ç¾¤å»ºè­°
cluster_advice = medical_advice_for_clusters(cluster_names, cluster_features)
for name, advice in cluster_advice.items():
    print(f"{name}:\n{advice}\n")